{% load static %}
<!-- ==================================================================================================== -->

<!-- LAWA.ai ChatBot -->

<!-- ==================================================================================================== -->



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Urbanist:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">
<link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
    rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<style>
    .main-chat-container {
        position: fixed;
        top: -100%;
        z-index: 99999999999;
        background-color: rgb(0, 0, 0, 0.4);
        font-family: "DM Sans", sans-serif;
    }

    .chat-container-wrapper {
        max-width: 1200px;
        width: 95vw;
        max-height: 800px;
        height: 95vh;
        background-color: white;
        border: 1px solid rgb(221, 221, 221);
        display: flex;
        flex-direction: column;
        box-shadow: 0px 0px 15px 8px rgba(255, 255, 255, 0.1);
        z-index: 999999999;
        /* border: 10 px solid red; */
        font-family: "DM Sans", sans-serif;
    }

    .chat-container-wrapper * {
        font-family: "DM Sans", sans-serif;
    }

    .chat-container-wrapper a {
        color: rgb(11, 172, 235);
        text-decoration: underline;
    }

    .d-none {
        display: none;
    }

    .main-chat-container {
        transition: opacity 0.5s ease-in-out;
    }

    .hide-chatbot {
        top: -100%;
        animation: slideaway 200ms;
        display: none;
        opacity: 0;
    }

    .show-chatbot {
        top: 0%;
        width: 100%;
        height: 100%;
        opacity: 1;
        z-index: 100000000;
        /* transform: translate(0%, 0); */
    }

    .closechatbot {
        background-color: rgb(240, 240, 240);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        /* aspect-ratio: 1; */
    }

    .closechatbot:hover {
        background-color: black;
    }

    .closechatbot:hover span svg {
        fill: #ffffff;
        stroke: #ffffff;
    }

    .closechatbot:hover span svg path {
        fill: #ffffff;
        stroke: #ffffff;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .styled-scrolllbar::-webkit-scrollbar {
        display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    ::-webkit-scrollbar {
        width: 6px;
        border-radius: 5px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .hide-scrolllbar::-webkit-scrollbar {
        display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .hide-scrolllbar {
        -ms-overflow-style: none;
        /* IE and Edge */
        scrollbar-width: none;
        /* Firefox */
    }

    .sample-question-block:hover {
        background-color: rgb(245, 245, 245);
    }

    .sendbtn {
        background-color: black;
        transition: all 0.2s ease-in-out;
        animation: scale-out 0.1s;
    }

    .sendbtn:hover {
        color: white;
        scale: 1.1;
    }

    .sendbtn:hover svg {
        stroke: white
    }

    div[contenteditable]:empty:before {
        content: attr(data-placeholder);
        display: inline-block;
        pointer-events: none;
    }

    div[contenteditable]:focus:empty:before {
        content: 'Start typing';
    }

    /* HTML: <div class="loader"></div> */
    /* HTML: <div class="loader"></div> */
    .chat-loader {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 10px;
    }

    .chat-loader .dot {
        width: 8px;
        aspect-ratio: 1;
        border-radius: 50%;
        background-color: gray;
        animation: l5 0.6s ease-in-out infinite;
    }

    .chat-loader .dot:nth-child(1) {
        animation-delay: 0s;
    }

    .chat-loader .dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .chat-loader .dot:nth-child(3) {
        animation-delay: 0.3s;
    }

    .neumorphic-box-shadow {
        border-radius: 50px;
        background: #e0e0e0;
        box-shadow: 20px 20px 17px #cecece,
            -20px -20px 17px #f2f2f2;
    }

    #micStartButton {
        background-color: rgb(240, 240, 240);
        transition: 0.2s ease-in-out;
    }

    #micStartButton:hover {
        scale: 1.1;
        background-color: rgb(220, 220, 220);
    }

    @keyframes l5 {
        0% {
            scale: 0.2;
            opacity: 0.2;
        }

        33% {
            scale: 0.5;
            opacity: 0.5;
        }

        66% {
            scale: 0.7;
            opacity: 0.7;
        }

        100% {
            scale: 1;
            opacity: 1;
        }
    }

    .pulse {
        animation: pulse-animation 2s infinite;
    }

    @keyframes pulse-animation {
        0% {
            scale: 0.9;
            box-shadow: 0 0 0 0px rgba(0, 0, 0, 0.2);
        }

        50% {
            scale: 1
        }

        100% {
            scale: 0.9;
            box-shadow: 0 0 0 20px rgba(0, 0, 0, 0);
        }
    }

    #userwayAccessibilityIcon {
        display: none;
    }

    .bg-special-secondary {
        background-color: rgb(230, 230, 230);
    }

    .message-content *:not(i) {
        font-family: "DM Sans", sans-serif;
    }

    .message-content h1,
    .message-content h2,
    .message-content h3,
    .message-content h4,
    .message-content h5,
    .message-content h6 {
        color: black;
    }

    .message-content h1 {
        font-size: 1.4rem;
    }

    .message-content h2 {
        font-size: 1.3rem;
    }

    .message-content h3 {
        font-size: 1.2rem;
    }

    .message-content h4 {
        font-size: 1.1rem;
    }

    .message-content h5 {
        font-size: 1rem;
    }

    .message-content h6 {
        font-size: 1rem;
    }

    .message-content strong {
        color: black;
        font-weight: bold;
    }

    .message-content a {
        text-wrap: pretty;
    }

    .message-content p {
        padding-top: 0px;
        margin-top: 0px;
        text-wrap: pretty;
    }

    .message-content ol {
        list-style: none;
    }

    .reference-item:hover{
        background-color: #f1f1f1;
    }

    .reference-item a{
        text-decoration: none;
    }

    .reference-item:hover a{
        text-decoration: underline;
    }

    .loading-text {
        position: relative;
    }

    .loading-text::after {
        content: '....';
        animation: loading-text-animation 1s infinite;
    }

    @keyframes loading-text-animation {
        0% {
            content: ''
        }

        25% {
            content: '.'
        }

        50% {
            content: '..'
        }

        75% {
            content: '...'
        }

        100% {
            content: '....'
        }
    }

    * New styles for RTL support */ .rtl {
        direction: rtl;
        text-align: right;
    }

    .rtl .chat-container-wrapper {
        direction: rtl;
    }

    .rtl .chatbot-header {
        flex-direction: row-reverse;
    }

    .rtl .chatbot-header div:first-of-type {
        order: 2;
    }

    .rtl .chatbot-header div:first-of-type {
        order: 1;
    }



    .rtl .question-item {
        text-align: right;
    }

    .rtl #question-box {
        text-align: right;
    }

    .rtl .chat-block {
        flex-direction: row-reverse;
    }

    .rtl .message-content {
        text-align: right;
    }

    .rtl .sendbtn {
        order: 3;
    }

    .rtl div[contenteditable]:focus:empty:before {
        content: 'ابدأ بالكتابة';
    }

    /* Language toggle button styles */
    .language-toggle {
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s;
        color: black;
    }

    .language-toggle:hover {
        background-color: black;
    }

    .control-btn {
        background-color: rgb(240, 240, 240);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        /* aspect-ratio: 1; */
    }

    .control-btn:hover {
        background-color: black;
    }

    .control-btn:hover span svg {
        fill: #ffffff;
        stroke: #ffffff;
    }

    .control-btn:hover span svg path {
        fill: #ffffff;
        stroke: #ffffff;
    }
</style>


<div class="main-chat-container hide-chatbot d-flex align-items-center justify-content-center"
    style="z-index: 10000000000;">
    <div class="container chat-container-wrapper hide-scrolllbar p-4 position-relative" style="border-radius: 30px;">
        <div class="chatbot-header d-flex align-items-center justify-content-between pb-2">
            <div style="display: flex; align-items: center; gap: 12px;">
                <svg width="40px" height="40px" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M15 0C6.71573 0 0 6.71582 0 15V35C0 43.2842 6.71573 50 15 50H35C43.2843 50 50 43.2842 50 35V15C50 6.71582 43.2843 0 35 0H15ZM25 40C16.7158 40 10 33.2842 10 25C10 16.7158 16.7158 10 25 10C33.2843 10 40 16.7158 40 25C40 27.3994 39.4366 29.6675 38.4348 31.6787C38.1686 32.2134 38.08 32.8242 38.2343 33.4009L39.1277 36.7402C39.5156 38.1895 38.1895 39.5156 36.74 39.1279L33.4009 38.2344C32.8241 38.0801 32.2132 38.1685 31.6787 38.4346C29.6674 39.4365 27.3996 40 25 40ZM25.261 12.6777C25.261 19.5811 30.8574 25.1777 37.761 25.1777C30.8574 25.1777 25.261 30.7739 25.261 37.6777C25.261 30.7739 19.6646 25.1777 12.761 25.1777C19.6646 25.1777 25.261 19.5811 25.261 12.6777Z"
                        fill="black" />
                </svg>
                <span class="text-dark mb-0 chatbot-title " style="font-weight: 800; font-size: 20px;">lawa.ai</span>
            </div>
            <div class="d-flex" style="gap: 5px;">
                <button
                    class="language-toggle control-btn btn btn-outline-dark d-flex align-items-center justify-content-center hover:text-white font-bold"
                    style="border-radius: 5px;" id="languageToggle"><span>AR</span>
                </button>
                <button
                    class="clearBtn control-btn btn btn-outline-dark border-0 d-flex align-items-center justify-content-center p-2"
                    style="border-radius: 5px;" type="button" data-toggle="tooltip" data-placement="top" title="Clear">
                    <span class="d-flex align-items-center justify-content-center" style="width: 18px; height: 18px;">
                        <svg fill="#000000" width="20px" height="20px" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg" stroke="#000000" stroke-width="0.312">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path
                                    d="M4,12a1,1,0,0,1-2,0A9.983,9.983,0,0,1,18.242,4.206V2.758a1,1,0,1,1,2,0v4a1,1,0,0,1-1,1h-4a1,1,0,0,1,0-2h1.743A7.986,7.986,0,0,0,4,12Zm17-1a1,1,0,0,0-1,1A7.986,7.986,0,0,1,7.015,18.242H8.757a1,1,0,1,0,0-2h-4a1,1,0,0,0-1,1v4a1,1,0,0,0,2,0V19.794A9.984,9.984,0,0,0,22,12,1,1,0,0,0,21,11Z">
                                </path>
                            </g>
                        </svg>
                    </span>
                </button>
                <button class="closechatbot control-btn btn d-flex align-items-center justify-content-center p-2"
                    style="border-radius: 5px;">
                    <span class="d-flex align-items-center justify-content-center" style="width: 20px; height: 20px;">
                        <svg width="20px" height="20px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"
                            fill="#000000">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path fill="#000000"
                                    d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z">
                                </path>
                            </g>
                        </svg>
                    </span>
                </button>
            </div>
        </div>
        <div class="chat-container w-100 mx-auto hide-scrolllbar mb-2"
            style="max-width: 800px; flex-grow: 1; padding: 10px 0px; display: flex; flex-direction: column; background-color: white; text-wrap: pretty; overflow-y: auto; overflow-x: hidden; border-radius: 20px;">
            <div class="start-block load-chat-block w-100 grow d-flex flex-column" style="flex-grow: 1;">
                <div class="w-100 flex-grow d-flex flex-column align-items-center justify-content-center y-4 text-center"
                    style="flex-grow: 1;">
                    <div class="mb-2">
                        <svg width="100px" height="100px" viewBox="0 0 50 50" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M15 0C6.71573 0 0 6.71582 0 15V35C0 43.2842 6.71573 50 15 50H35C43.2843 50 50 43.2842 50 35V15C50 6.71582 43.2843 0 35 0H15ZM25 40C16.7158 40 10 33.2842 10 25C10 16.7158 16.7158 10 25 10C33.2843 10 40 16.7158 40 25C40 27.3994 39.4366 29.6675 38.4348 31.6787C38.1686 32.2134 38.08 32.8242 38.2343 33.4009L39.1277 36.7402C39.5156 38.1895 38.1895 39.5156 36.74 39.1279L33.4009 38.2344C32.8241 38.0801 32.2132 38.1685 31.6787 38.4346C29.6674 39.4365 27.3996 40 25 40ZM25.261 12.6777C25.261 19.5811 30.8574 25.1777 37.761 25.1777C30.8574 25.1777 25.261 30.7739 25.261 37.6777C25.261 30.7739 19.6646 25.1777 12.761 25.1777C19.6646 25.1777 25.261 19.5811 25.261 12.6777Z"
                                fill="black" />
                        </svg>
                    </div>
                    <h2 class="text-center text-dark block mx-auto start-message"
                        style="max-width: 500px; margin-top: 10px; font-weight: 600; text-wrap:pretty;">
                        Start asking your questions and the agent will answer them.
                    </h2>
                </div>
                <div class="w-100 mx-auto d-flex">
                    <div class="w-100 d-flex justify-content-between" style="gap: 16px;">
                        <div style="cursor: pointer; border-radius: 16px;"
                            class="sample-question-block w-100 d-flex flex-column align-items-start justify-content-start  overflow-hidden border p-3">
                            <svg width="24px" height="24px" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 640 512"><!--!Font Awesome Free 6.7.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                                <path
                                    d="M381 114.9L186.1 41.8c-16.7-6.2-35.2-5.3-51.1 2.7L89.1 67.4C78 73 77.2 88.5 87.6 95.2l146.9 94.5L136 240 77.8 214.1c-8.7-3.9-18.8-3.7-27.3 .6L18.3 230.8c-9.3 4.7-11.8 16.8-5 24.7l73.1 85.3c6.1 7.1 15 11.2 24.3 11.2l137.7 0c5 0 9.9-1.2 14.3-3.4L535.6 212.2c46.5-23.3 82.5-63.3 100.8-112C645.9 75 627.2 48 600.2 48l-57.4 0c-20.2 0-40.2 4.8-58.2 14L381 114.9zM0 480c0 17.7 14.3 32 32 32l576 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 448c-17.7 0-32 14.3-32 32z" />
                            </svg>
                            <p class="question-item w-100 mb-0 text-base mt-2">
                                List out the tours to United Arab Emirates.
                            </p>
                        </div>
                        <div style="cursor: pointer; border-radius: 16px;"
                            class="sample-question-block w-100 d-flex flex-column align-items-start justify-content-start overflow-hidden border p-3">
                            <svg width="24px" height="24px" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                                <path
                                    d="M0 64C0 28.7 28.7 0 64 0L384 0c35.3 0 64 28.7 64 64l0 384c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zM183 278.8c-27.9-13.2-48.4-39.4-53.7-70.8l39.1 0c1.6 30.4 7.7 53.8 14.6 70.8zm41.3 9.2l-.3 0-.3 0c-2.4-3.5-5.7-8.9-9.1-16.5c-6-13.6-12.4-34.3-14.2-63.5l47.1 0c-1.8 29.2-8.1 49.9-14.2 63.5c-3.4 7.6-6.7 13-9.1 16.5zm40.7-9.2c6.8-17.1 12.9-40.4 14.6-70.8l39.1 0c-5.3 31.4-25.8 57.6-53.7 70.8zM279.6 176c-1.6-30.4-7.7-53.8-14.6-70.8c27.9 13.2 48.4 39.4 53.7 70.8l-39.1 0zM223.7 96l.3 0 .3 0c2.4 3.5 5.7 8.9 9.1 16.5c6 13.6 12.4 34.3 14.2 63.5l-47.1 0c1.8-29.2 8.1-49.9 14.2-63.5c3.4-7.6 6.7-13 9.1-16.5zM183 105.2c-6.8 17.1-12.9 40.4-14.6 70.8l-39.1 0c5.3-31.4 25.8-57.6 53.7-70.8zM352 192A128 128 0 1 0 96 192a128 128 0 1 0 256 0zM112 384c-8.8 0-16 7.2-16 16s7.2 16 16 16l224 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-224 0z" />
                            </svg>
                            <p class="question-item w-100 mb-0 text-base mt-2">
                                Which documents are required to get France visa?
                            </p>
                        </div>
                        <div style="cursor: pointer; border-radius: 16px;"
                            class="sample-question-block w-100 d-flex flex-column align-items-start justify-content-start  overflow-hidden border p-3">
                            <svg width="24px" height="24px" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                                <path
                                    d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z" />
                            </svg>
                            <p class="question-item w-100 mb-0 text-base mt-2">
                                Suggest me some places to visit in India.
                            </p>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <div class="w-100 bg-transparent">
            <div class="input-options-container d-flex flex-row align-items-center justify-content-between border rounded-xl shadow-sm mx-auto"
                style="max-width: 800px; width: 100%; gap: 16px; padding: 10px;">
                <button id="micStartButton"
                    style="width: 40px; height: 40px; padding: 10px; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 30px; border: none; color: white; outline: none;">
                    <svg width="18px" height="18px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512">
                        <path
                            d="M176 352c53 0 96-43 96-96V96c0-53-43-96-96-96S80 43 80 96v160c0 53 43 96 96 96zm160-160h-16c-8.8 0-16 7.2-16 16v48c0 74.8-64.5 134.8-140.8 127.4C96.7 376.9 48 317.1 48 250.3V208c0-8.8-7.2-16-16-16H16c-8.8 0-16 7.2-16 16v40.2c0 89.6 64 169.6 152 181.7V464H96c-8.8 0-16 7.2-16 16v16c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-16c0-8.8-7.2-16-16-16h-56v-33.8C285.7 418.5 352 344.9 352 256v-48c0-8.8-7.2-16-16-16z" />
                    </svg>
                </button>
                <div id="question-box" class="d-inline-block" role="textbox" contenteditable="true"
                    data-placeholder="Write your question here... "
                    style="width: 100%; max-height: 100px; outline: none; font-weight: 500; font-size: 16px;"></div>
                <button class="sendbtn"
                    style="width: 40px; height: 40px; padding: 8px; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 30px; border: none; color: white;">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

<button
    class="startchatbtn pulse btn btn-warning border-0 rounded-circle d-flex align-items-center justify-content-center p-2 bg-yellow-500"
    style="width: 50px; height:50px; position: fixed; bottom: 20px; right: 20px; z-index: 99999; cursor: pointer;">
    <svg width="30px" height="30px" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd"
            d="M15 0C6.71573 0 0 6.71582 0 15V35C0 43.2842 6.71573 50 15 50H35C43.2843 50 50 43.2842 50 35V15C50 6.71582 43.2843 0 35 0H15ZM25 40C16.7158 40 10 33.2842 10 25C10 16.7158 16.7158 10 25 10C33.2843 10 40 16.7158 40 25C40 27.3994 39.4366 29.6675 38.4348 31.6787C38.1686 32.2134 38.08 32.8242 38.2343 33.4009L39.1277 36.7402C39.5156 38.1895 38.1895 39.5156 36.74 39.1279L33.4009 38.2344C32.8241 38.0801 32.2132 38.1685 31.6787 38.4346C29.6674 39.4365 27.3996 40 25 40ZM25.261 12.6777C25.261 19.5811 30.8574 25.1777 37.761 25.1777C30.8574 25.1777 25.261 30.7739 25.261 37.6777C25.261 30.7739 19.6646 25.1777 12.761 25.1777C19.6646 25.1777 25.261 19.5811 25.261 12.6777Z"
            fill="black" />
    </svg>
</button>

<!-- SocketIO -->
<script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
<!-- Showdown.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"
    integrity="sha512-LhccdVNGe2QMEfI3x4DVV3ckMRe36TfydKss6mJpdHjNFiV07dFpS2xzeZedptKZrwxfICJpez09iNioiSZ3hA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    const startButton = document.getElementById('micStartButton');

    let recognition;
    let isRecording = false;
    let isSupported = true;
    let silenceTimer;
    const silenceThreshold = 1000; // 1.5 seconds of silence before stopping


    const socket = new WebSocket('https://ritesh-hf-web-agent.hf.space/ws');

    socket.onopen = function (event) {
			console.log('WebSocket is open now.');
		};

    if ('webkitSpeechRecognition' in window) {

        recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US'; // Default language

        recognition.onstart = function () {
            isRecording = true;
            startButton.classList.add("pulse");
            $("#question-box").attr("data-placeholder", translations[currentLanguage].listeningPlaceholder);
        };

        recognition.onresult = function (event) {
            let interimTranscript = '';
            let finalTranscript = '';

            for (let i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    finalTranscript += event.results[i][0].transcript;
                    $("#question-box").text(finalTranscript);
                } else {
                    interimTranscript += event.results[i][0].transcript;
                    $("#question-box").text(interimTranscript);
                }
            }
            // Reset the silence timer whenever we get a result
            resetSilenceTimer();
        };

        recognition.onerror = function (event) {
            console.error('Speech recognition error:', event.error);
            if (!isSupported) {
                alert("Sorry, Voice capture is not supported for your current system.")
            } else {
                alert(event.error);
            }
        };

        recognition.onend = function () {
            isRecording = false;
            startButton.classList.remove("pulse");
            $("question-box").html("");
        };

    }
    else {
        isSupported = false;
    }

    startButton.addEventListener('click', function () {
        if (!isSupported) {
            alert("Sorry, Voice capture is not supported for your current system.")
        } else {
            if (isRecording) {
                stopRecording();
                $("question-box").html("");
            } else {
                startRecording();
            }
        }
    });

    function startRecording() {
        recognition.start();
    }

    function stopRecording() {
        recognition.stop();
        clearTimeout(silenceTimer);
    }

    function resetSilenceTimer() {
        clearTimeout(silenceTimer);
        silenceTimer = setTimeout(() => {
            if (isRecording) {
                stopRecording();
                $(".sendbtn").click();
                $("question-box").html("");
            }
        }, silenceThreshold);
    }

    // Empty response variable to keep track of response
    var response = "";

    // Converter for Markdown to HTML
    var converter = new showdown.Converter();

    // Function to load a chat block indicating that the system is searching
    function loadChatBlock() {
        let lastMessageElement = $(".chat-container div:last-child");
        if (lastMessageElement.hasClass("response-block")) {
            return;
        }
        const isRTL = currentLanguage === 'ar';
        $(".chat-container").append(
            `
                    <div class="chat-block load-chat-block w-100 d-flex ${isRTL ? 'flex-row-reverse' : 'flex-row'} align-items-center ${isRTL ? 'justify-content-end' : 'justify-content-start'} p-3${isRTL ? 'rtl' : ''}">
                        <div style="width: fit-content; margin-bottom: 5px; display: flex; align-items: center; gap: 15px;" class="${isRTL ? 'order-2' : ''}">
                            <span style="display: flex; align-items: center; justify-content: center; border-radius: 50px; background-color: white;">
                                <svg width="36" height="36" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0ZM15 24C10.0295 24 6 19.9705 6 15C6 10.0294 10.0295 6 15 6C19.9706 6 24 10.0294 24 15C24 16.4397 23.6619 17.8004 23.0609 19.0072C22.9012 19.3279 22.848 19.6945 22.9406 20.0405L23.4766 22.044C23.7093 22.9137 22.9137 23.7093 22.044 23.4767L20.0406 22.9406C19.6945 22.848 19.3279 22.9012 19.0072 23.0608C17.8005 23.662 16.4397 24 15 24ZM15.1566 7.60664C15.1566 11.7488 18.5144 15.1066 22.6566 15.1066C18.5144 15.1066 15.1566 18.4645 15.1566 22.6066C15.1566 18.4645 11.7987 15.1066 7.65659 15.1066C11.7987 15.1066 15.1566 11.7488 15.1566 7.60664Z" fill="black"/>
                                </svg>
                            </span>
                        </div>
                        <div class="px-3 ${isRTL ? 'order-1' : ''}">
                            <div class="message-content pr-2" style="width: 100%; height: 100%; margin: auto; font-weight: 500; text-wrap: pretty; ${isRTL ? 'text-align: right;' : ''}">
                            <span class="loading-text">${isRTL ? 'البحث' : 'Searching'}</span>
                            </div>
                        </div>
                    </div>
                `
        );
    }

    function appendQuestion(question) {
        if (!$(".start-block").hasClass("d-none")) {
            $(".start-block").slideUp(200);
            $(".start-block").addClass("d-none");
            $(".start-block").removeClass("d-flex");
        }

        const isRTL = currentLanguage === 'ar';

        $(".chat-container").append(`
                <div class="chat-block question-block w-100 d-flex align-items-start justify-content-start ${isRTL ? 'justify-content-end' : 'justify-content-start'} p-3 mb-2 ${isRTL ? 'rtl' : ''}" style="border-radius: 16px; background-color: rgb(238, 238, 238);">
                    <div class="d-flex align-align-items-center ${isRTL ? 'order-2' : ''}">
                        <span
                            style="width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50px; padding: 3px; border: 2px solid #000000; background-color: black;">
                            <svg fill="#ffffff" width="36px" height="36px" viewBox="0 0 256 256" id="Flat"
                                xmlns="http://www.w3.org/2000/svg">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path
                                        d="M128,76a44,44,0,1,1-44,44A43.99983,43.99983,0,0,1,128,76Zm48-12h16V80a8,8,0,0,0,16,0V64h16a8,8,0,0,0,0-16H208V32a8,8,0,0,0-16,0V48H176a8,8,0,0,0,0,16Zm45.56006,40.95605a8.00039,8.00039,0,0,0-6.64893,9.15381A89.00044,89.00044,0,0,1,216,128a87.63672,87.63672,0,0,1-22.24182,58.41016,79.7044,79.7044,0,0,0-24.431-22.97461,59.83641,59.83641,0,0,1-82.6543,0A79.70345,79.70345,0,0,0,62.2417,186.41016,87.9498,87.9498,0,0,1,128,40a89.02966,89.02966,0,0,1,13.89062,1.08887,7.99994,7.99994,0,1,0,2.50391-15.80274A104.0826,104.0826,0,0,0,24,128a103.74716,103.74716,0,0,0,33.81934,76.68066,7.94507,7.94507,0,0,0,1.32629,1.18946,103.784,103.784,0,0,0,137.71252-.00293,7.94633,7.94633,0,0,0,1.31678-1.18115A103.74751,103.74751,0,0,0,232,128a105.04749,105.04749,0,0,0-1.28613-16.39453A7.99752,7.99752,0,0,0,221.56006,104.95605Z">
                                    </path>
                                </g>
                            </svg>
                        </span>
                    </div>
                    <div class="px-3 py-1 ${isRTL ? 'order-1' : ''}">
                        <div class="message-content pr-2" style="width: 100%; margin: auto; text-wrap: pretty; font-size: 18px; color: black; ${isRTL ? 'text-align: right;' : ''}">
                            <span>${question}</span>
                        </div>
                    </div>
                </div>
            `);

        $(".chat-container").animate({
            scrollTop: $('.chat-container')[0].scrollHeight
        }, 1000);
    }

    // Function to handle sending a question via Socket.IO and receiving an answer
    function provideQuestionToAnswer() {
        response = "";
        let question = $("#question-box").text();
        appendQuestion(question);
        $("#question-box").text("");
        setTimeout(loadChatBlock, 600);
        // Emit question and language via Socket.IO
		socket.send(JSON.stringify({ question: question, session_id: 'abc123', language: currentLanguage }));
    }

    function appendAnswer(answer) {
        let lastElement = $(".chat-container .chat-block:last-child");
        const isRTL = currentLanguage === 'ar';

        if (lastElement.hasClass("response-block")) {
            $(".chat-container .chat-block:last-child").find(".message-content").html(answer);
        } else {
            lastElement.remove();
            $(".chat-container").append(`
                    <div class="chat-block response-block w-100 d-flex ${isRTL ? 'flex-row-reverse' : 'flex-row'} align-items-start ${isRTL ? 'justify-content-end' : 'justify-content-start'} p-3 ${isRTL ? 'rtl' : ''}">
                        <div style="width: fit-content; margin-bottom: 5px; display: flex; align-items: center; gap: 15px;" class="${isRTL ? 'order-2' : ''}">
                            <span
                                style="display: flex; align-items: center; justify-content: center; border-radius: 50px; background-color: white;">
                                <svg width="36" height="36" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0ZM15 24C10.0295 24 6 19.9705 6 15C6 10.0294 10.0295 6 15 6C19.9706 6 24 10.0294 24 15C24 16.4397 23.6619 17.8004 23.0609 19.0072C22.9012 19.3279 22.848 19.6945 22.9406 20.0405L23.4766 22.044C23.7093 22.9137 22.9137 23.7093 22.044 23.4767L20.0406 22.9406C19.6945 22.848 19.3279 22.9012 19.0072 23.0608C17.8005 23.662 16.4397 24 15 24ZM15.1566 7.60664C15.1566 11.7488 18.5144 15.1066 22.6566 15.1066C18.5144 15.1066 15.1566 18.4645 15.1566 22.6066C15.1566 18.4645 11.7987 15.1066 7.65659 15.1066C11.7987 15.1066 15.1566 11.7488 15.1566 7.60664Z"
                                        fill="black"></path>
                                </svg>
                            </span>
                        </div>

                        <div class="px-3 py-2 ${isRTL ? 'order-1' : ''}">
                            <div class="message-content pr-2"
                                style="width: 100%; height: 100%; margin: auto; font-weight: 500; text-wrap: pretty; ${isRTL ? 'text-align: right;' : ''}">
                                ${answer}
                            </div>
							<div class="references-block">
							
							</div>
                        </div>
                    </div>
                `);
        }

        $(".chat-container").scrollTop($(".chat-container")[0].scrollHeight);
    }

    // Open the chatbot interface
    function openchatbot() {
        console.log("working here");
        $(".main-chat-container").removeClass("hide-chatbot");
        $(".main-chat-container").addClass("show-chatbot");
        $(".startchatbtn").addClass("d-none");
        $(".startchatbtn").removeClass("d-flex");
    }

    // Close the chatbot interface
    $(".startchatbtn").click(openchatbot);

    $(".closechatbot").click(function () {
        $(".main-chat-container").removeClass("show-chatbot");
        $(".main-chat-container").addClass("hide-chatbot");
        $(".startchatbtn").removeClass("d-none");
        $(".startchatbtn").addClass("d-flex");
    });

    // Send the question and get the answer
    $(".sendbtn").click(provideQuestionToAnswer);

    // Handle the Enter key press in the question box
    $(document).ready(() => {
        $("#question-box").text("Write your question here...");
        $("#question-box").text("");

        $('#question-box').on('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                provideQuestionToAnswer();
            }
        });

        let currentLanguage = localStorage.getItem("currentLanguage");
        if (currentLanguage && currentLanguage == 'ar') {
            toggleLanguage();
        }
    });

    // Function to handle the answer received from the server
    socket.onmessage = function (event) {
        let initialResponse = JSON.parse(event.data);
        if ("response" in initialResponse) {
            let data = initialResponse.response;
            response += data;
            model_response = converter.makeHtml(response);
            appendAnswer(model_response);
        }
        if ("sources" in initialResponse) {
            let data = initialResponse.sources;
            console.log(data);

            let ref_childs = "";

            for (const [key, url] of Object.entries(data)){
                ref_childs += `
                    <div class="reference-item w-fit d-flex align-items-center mr-3 mb-3 border rounded-lg">
                        <a class="block px-3 py-2 hover:underline" href="${url}" target="_blank">${key} Source</a>
                    </div>
                `
            }

            let htmlContent = `
                <div class="d-flex flex-wrap">
                    ${ref_childs}
                </div>
            `
            let lastElement = $(".chat-container .chat-block:last-child");

            if (lastElement.hasClass("response-block")) {
                $(".chat-container .chat-block:last-child").find(".references-block").html(htmlContent);
            }
        }
    };


    socket.onclose = function (event) {
        console.log('WebSocket is closed now.');
    };

    socket.onerror = function (error) {
        console.log('WebSocket error:', error);
        appendMessage("Sorry, there was a problem connecting to the server. Please try again later.");
    };

    // Clear the chat container
    $(".clearBtn").click(() => {
        $('.chat-container').find('.chat-block').remove();
        $(".start-block").removeClass('d-none');
        $(".start-block").addClass('d-flex');
        $(".start-block").slideDown();
        sessionStorage.setItem("chats", JSON.stringify([]));
    });

    // Handle click on example questions
    $(".sample-question-block").on("click", (e) => {
        let exampleQuestion = $(e.currentTarget).find(".question-item").text();;
        $("#question-box").text(exampleQuestion);
        $(".sendbtn").click();
    });


    // New variables for language support
    let currentLanguage = 'en';
    const languageToggle = document.getElementById('languageToggle');
    const chatContainer = document.querySelector('.chat-container-wrapper');
    const questionBox = document.getElementById('question-box');


    // Translation object
    const translations = {
        en: {
            title: 'lawa.ai',
            clear: 'Clear',
            close: 'Close',
            start: 'Start Chat',
            send: 'Send',
            startMessage: 'Start asking your questions and the agent will answer them.',
            questionPlaceholder: 'Write your question here...',
            listeningPlaceholder: 'Listening...',
            exampleQuestions: [
                'List out the tours to United Arab Emirates',
                'Which documents are required to get France visa?',
                'Suggest me some places to visit in India'
            ]
        },
        ar: {
            title: 'لاوا.أي',
            clear: 'مسح',
            close: 'إغلاق',
            start: 'بدء المحادثة',
            send: 'إرسال',
            startMessage: 'ابدأ بطرح أسئلتك وسيجيب عليها الوكيل.',
            questionPlaceholder: 'اكتب سؤالك هنا...',
            listeningPlaceholder: 'جاري الاستماع...',
            exampleQuestions: [
                'قائمة بالجولات إلى الإمارات العربية المتحدة',
                'ما هي المستندات المطلوبة للحصول على تأشيرة فرنسا؟',
                'اقترحوا لي بعض الأماكن التي يمكن زيارتها في الهند'
            ]
        }
    };

    // Function to update UI language
    function updateUILanguage() {
        const elements = {
            title: document.querySelector('.chatbot-title'),
            clearBtn: document.querySelector('.clearBtn'),
            closechatbot: document.querySelector('.closechatbot'),
            startchatbtn: document.querySelector('.startchatbtn'),
            sendbtn: document.querySelector('.sendbtn'),
            startMessage: document.querySelector('.start-message'),
            questionBox: document.getElementById('question-box'),
            questionItems: document.querySelectorAll('.question-item')
        };

        elements.title.textContent = translations[currentLanguage].title;
        elements.closechatbot.setAttribute('title', translations[currentLanguage].close);
        elements.startchatbtn.setAttribute('title', translations[currentLanguage].start);
        elements.sendbtn.setAttribute('title', translations[currentLanguage].send);
        elements.startMessage.textContent = translations[currentLanguage].startMessage;
        elements.questionBox.setAttribute('data-placeholder', translations[currentLanguage].questionPlaceholder);

        elements.questionItems.forEach((item, index) => {
            item.textContent = translations[currentLanguage].exampleQuestions[index];
        });

        // Update the listening placeholder for speech recognition
        if (recognition) {
            recognition.lang = currentLanguage === 'ar' ? 'ar-AE' : 'en-US';
        }
    }

    // Function to toggle language
    function toggleLanguage() {
        $(".clearBtn").click();
        currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
        languageToggle.textContent = currentLanguage === 'en' ? "AR" : "EN";
        chatContainer.classList.toggle('rtl', currentLanguage === 'ar');
        questionBox.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr');
        document.body.style.direction = currentLanguage === 'ar' ? 'rtl' : 'ltr';
        chatContainer.classList.toggle('rtl', currentLanguage === 'ar');
        updateUILanguage();

        localStorage.setItem("currentLanguage", currentLanguage);
    }

    // Event listeners and initializations
    languageToggle.addEventListener('click', toggleLanguage);

    // Initialize the UI language
    updateUILanguage();

</script>

<!-- ==================================================================================================== -->

<!-- LAWA.ai ChatBot -->

<!-- ==================================================================================================== -->